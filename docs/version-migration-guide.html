<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Version Migration Guide - AI Chat Studio</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #333;
            font-size: 1.4em;
            margin-bottom: 15px;
            margin-top: 25px;
        }

        .section h4 {
            color: #555;
            font-size: 1.2em;
            margin-bottom: 10px;
            margin-top: 20px;
        }

        .section p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .section ul, .section ol {
            margin-bottom: 15px;
            padding-left: 30px;
        }

        .section li {
            margin-bottom: 8px;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .code-block code {
            background: none;
            padding: 0;
            color: #d63384;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #f39c12;
        }

        .warning strong {
            color: #856404;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #17a2b8;
        }

        .info strong {
            color: #0c5460;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }

        .success strong {
            color: #155724;
        }

        .danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #dc3545;
        }

        .danger strong {
            color: #721c24;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card h4 {
            color: #667eea;
            margin-top: 0;
            margin-bottom: 15px;
        }

        .nav {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .nav h3 {
            margin-bottom: 15px;
            color: #667eea;
        }

        .nav a {
            display: block;
            color: #495057;
            text-decoration: none;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .nav a:hover {
            color: #667eea;
        }

        .nav a:last-child {
            border-bottom: none;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th, .comparison-table td {
            border: 1px solid #e9ecef;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .version-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 5px;
        }

        .deprecated {
            background: #ffc107;
            color: #212529;
        }

        .new-feature {
            background: #28a745;
            color: white;
        }

        .breaking-change {
            background: #dc3545;
            color: white;
        }

        .migration-step {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
        }

        .file-structure {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 15px 0;
        }

        .file-structure .folder { color: #667eea; }
        .file-structure .file { color: #28a745; }
        .file-structure .deprecated { color: #ffc107; }
        .file-structure .new { color: #17a2b8; }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Version Migration Guide</h1>
            <p>Upgrade and migrate between AI Chat Studio versions safely</p>
        </div>

        <div class="nav">
            <h3>Table of Contents</h3>
            <a href="#overview">Overview</a>
            <a href="#version-history">Version History</a>
            <a href="#pre-migration">Pre-Migration Checklist</a>
            <a href="#v1-to-v2">v1.0.0 to v2.0.0 Migration</a>
            <a href="#backup-procedures">Backup Procedures</a>
            <a href="#migration-process">Migration Process</a>
            <a href="#post-migration">Post-Migration Verification</a>
            <a href="#rollback-procedures">Rollback Procedures</a>
            <a href="#troubleshooting">Troubleshooting</a>
        </div>

        <div class="content">
            <div class="section" id="overview">
                <h2>Overview</h2>
                <p>This guide provides comprehensive instructions for migrating between different versions of AI Chat Studio. Whether you're upgrading from v1.0.0 to v2.0.0 or migrating from external systems, this guide ensures a smooth transition with minimal downtime and data loss.</p>
                
                <div class="info">
                    <strong>Migration Types Covered:</strong>
                    <ul>
                        <li>Upgrading from v1.0.0 to v2.0.0</li>
                        <li>Side-by-side installations</li>
                        <li>Data migration and conversion</li>
                        <li>Configuration migration</li>
                        <li>Custom code adaptation</li>
                    </ul>
                </div>

                <h3>Migration Philosophy</h3>
                <div class="grid">
                    <div class="card">
                        <h4><i class="fas fa-sync-alt"></i> Backward Compatibility</h4>
                        <p>Where possible, we maintain compatibility with previous versions to ease the migration process.</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-shield-alt"></i> Safe Migration</h4>
                        <p>All migrations should be performed safely with comprehensive backups and rollback options.</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-chart-bar"></i> Data Preservation</h4>
                        <p>User data, chat histories, and configurations should be preserved during migration.</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-bolt"></i> Minimal Downtime</h4>
                        <p>Migrations should be completed quickly to minimize service interruption.</p>
                    </div>
                </div>

                <div class="warning">
                    <strong>Important:</strong> Always test migrations in a development environment before applying to production. Migration procedures may vary based on your specific configuration and customizations.
                </div>
            </div>

            <div class="section" id="version-history">
                <h2>Version History & Changes</h2>
                
                <h3>AI Chat Studio Versions</h3>
                
                <h4><span class="version-badge new-feature">v2.0.0</span> Latest Version</h4>
                <div class="info">
                    <strong>Release Date:</strong> 2024 | <strong>Status:</strong> Current
                </div>
                <ul>
                    <li><i class="fas fa-check-circle"></i> <strong>Modern Architecture:</strong> Complete rewrite with improved structure</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Enhanced UI/UX:</strong> New responsive design with dark mode</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Plugin System:</strong> Extensible architecture with plugin support</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Multiple AI Providers:</strong> Support for OpenAI, Anthropic, Google, and local models</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Improved Performance:</strong> Optimized for better speed and efficiency</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Security Enhancements:</strong> Better API key management and security practices</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Mobile Optimization:</strong> Enhanced mobile experience</li>
                    <li><i class="fas fa-check-circle"></i> <strong>Accessibility:</strong> WCAG 2.1 compliance improvements</li>
                </ul>

                <h4><span class="version-badge">v1.0.0</span> Legacy Version</h4>
                <div class="warning">
                    <strong>Status:</strong> Legacy - No longer receiving updates
                </div>
                <ul>
                    <li><i class="fas fa-check-circle"></i> Basic chat functionality with single AI provider</li>
                    <li><i class="fas fa-check-circle"></i> Simple PHP backend</li>
                    <li><i class="fas fa-check-circle"></i> Basic styling and responsive design</li>
                    <li><i class="fas fa-times-circle"></i> Limited customization options</li>
                    <li><i class="fas fa-times-circle"></i> No plugin system</li>
                    <li><i class="fas fa-times-circle"></i> Single provider limitation</li>
                    <li><i class="fas fa-times-circle"></i> Basic security features</li>
                </ul>

                <h3>Comparison Table</h3>
                
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>v1.0.0</th>
                            <th>v2.0.0</th>
                            <th>Migration Impact</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AI Providers</td>
                            <td>Single (OpenAI only)</td>
                            <td>Multiple (OpenAI, Anthropic, Google, Local)</td>
                            <td><span class="breaking-change">Breaking</span></td>
                        </tr>
                        <tr>
                            <td>UI Framework</td>
                            <td>Basic CSS</td>
                            <td>Modern CSS with variables</td>
                            <td><span class="new-feature">Enhanced</span></td>
                        </tr>
                        <tr>
                            <td>Configuration</td>
                            <td>Simple arrays</td>
                            <td>Environment variables + config files</td>
                            <td><span class="breaking-change">Breaking</span></td>
                        </tr>
                        <tr>
                            <td>API Structure</td>
                            <td>Basic endpoints</td>
                            <td>RESTful API with versioning</td>
                            <td><span class="breaking-change">Breaking</span></td>
                        </tr>
                        <tr>
                            <td>Security</td>
                            <td>Basic</td>
                            <td>Enhanced with CSP, rate limiting</td>
                            <td><span class="new-feature">Enhanced</span></td>
                        </tr>
                        <tr>
                            <td>Mobile Support</td>
                            <td>Basic responsive</td>
                            <td>Fully optimized mobile experience</td>
                            <td><span class="new-feature">Enhanced</span></td>
                        </tr>
                        <tr>
                            <td>Plugin System</td>
                            <td>Not available</td>
                            <td>Full plugin architecture</td>
                            <td><span class="new-feature">New</span></td>
                        </tr>
                        <tr>
                            <td>Internationalization</td>
                            <td>Not available</td>
                            <td>Multi-language support</td>
                            <td><span class="new-feature">New</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section" id="pre-migration">
                <h2>Pre-Migration Checklist</h2>
                
                <h3>Environment Assessment</h3>
                
                <h4>Current System Analysis</h4>
                <div class="code-block">
                    <code># Check current version
# Look for version information in:
# - index.php file header
# - package.json
# - README.md

# Analyze current structure
ls -la v1.0.0/  # or main/
find . -name "*.php" | head -10
find . -name "*.js" | head -10
find . -name "*.css" | head -10

# Check PHP version
php -v

# Check installed extensions
php -m | grep -E "(curl|json|mbstring)"

# Check web server
apache2 -v  # or nginx -v
</code>
                </div>

                <h3>Dependencies Verification</h3>
                
                <div class="warning">
                    <strong>Required for v2.0.0:</strong>
                    <ul>
                        <li>PHP 8.0+ (PHP 7.4+ minimum)</li>
                        <li>Web server: Apache 2.4+ or Nginx 1.18+</li>
                        <li>PHP Extensions: cURL, JSON, mbstring, OpenSSL</li>
                        <li>SSL Certificate (recommended for production)</li>
                        <li>Disk space: 100MB+</li>
                    </ul>
                </div>

                <h3>Data Inventory</h3>
                
                <h4>Files to Preserve</h4>
                <div class="code-block">
                    <code># Create inventory of important files
find . -type f \( -name "*.json" -o -name "*.env" -o -name "*.yml" -o -name "*.yaml" \) > important_files.txt

# Check for custom configurations
find . -name "config.*" -o -name "settings.*" > config_files.txt

# List user uploaded content
find . -type d -name "uploads" -o -name "user-data" -o -name "custom" > user_dirs.txt
</code>
                </div>

                <div class="migration-step">
                    <h4><i class="fas fa-clipboard-list"></i> Migration Planning</h4>
                    <ol>
                        <li><strong>Schedule:</strong> Choose low-traffic period for migration</li>
                        <li><strong>Backup:</strong> Complete system backup before starting</li>
                        <li><strong>Testing:</strong> Set up test environment for validation</li>
                        <li><strong>Documentation:</strong> Document current customizations</li>
                        <li><strong>Communication:</strong> Notify users of planned maintenance</li>
                        <li><strong>Rollback Plan:</strong> Prepare rollback procedures</li>
                    </ol>
                </div>
            </div>

            <div class="section" id="v1-to-v2">
                <h2>v1.0.0 to v2.0.0 Migration</h2>
                
                <h3>Major Changes Overview</h3>
                
                <h4>Directory Structure Changes</h4>
                <div class="file-structure">
<span class="folder">v1.0.0/</span> (Legacy)
├── <span class="file">index.php</span>
├── <span class="file">chat.php</span>
├── <span class="folder">assets/</span>
│   ├── <span class="file">style.css</span>
│   └── <span class="file">app.js</span>
└── <span class="folder">includes/</span>
    └── <span class="file">config.php</span>

<span class="folder">v2.0.0/</span> (Current)
├── <span class="file">index.php</span>
├── <span class="file">manifest.json</span>
├── <span class="folder">api/</span>
│   └── <span class="file">chat.php</span>
├── <span class="folder">assets/</span>
│   ├── <span class="folder">css/</span>
│   │   ├── <span class="file">style.css</span>
│   │   └── <span class="file">themes.css</span>
│   ├── <span class="folder">js/</span>
│   │   ├── <span class="file">app.js</span>
│   │   └── <span class="file">plugins.js</span>
│   └── <span class="folder">images/</span>
├── <span class="folder">pages/</span>
│   ├── <span class="file">about.php</span>
│   ├── <span class="file">settings.php</span>
│   └── <span class="file">faqs.php</span>
└── <span class="folder">vendor/</span>
    └── <span class="file">autoload.php</span>
                </div>

                <h3>Configuration Migration</h3>
                
                <h4>v1.0.0 Configuration (config.php)</h4>
                <div class="code-block">
                    <code><?php
// v1.0.0 configuration structure
$config = [
    'openai' => [
        'api_key' => 'your-openai-api-key',
        'model' => 'gpt-3.5-turbo',
        'max_tokens' => 1024,
        'temperature' => 0.7
    ],
    'ui' => [
        'theme' => 'default',
        'language' => 'en',
        'show_typing' => true
    ],
    'security' => [
        'rate_limit' => 10,
        'session_timeout' => 3600
    ]
];
</code>
                </div>

                <h4>v2.0.0 Environment Configuration</h4>
                <div class="code-block">
                    <code># v2.0.0 uses environment variables and config files

# .env file structure
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

# AI Provider Configuration
OPENAI_API_KEY=your-openai-api-key
OPENAI_MODEL=gpt-3.5-turbo
OPENAI_MAX_TOKENS=1024
OPENAI_TEMPERATURE=0.7

# Additional Providers
ANTHROPIC_API_KEY=your-anthropic-key
ANTHROPIC_MODEL=claude-3-sonnet-20240229

GOOGLE_API_KEY=your-google-key
GOOGLE_MODEL=gemini-pro

# Security Settings
SECURE_API_KEYS=true
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=10
RATE_LIMIT_WINDOW=60

# UI Configuration
DEFAULT_THEME=default
DEFAULT_LANGUAGE=en
ENABLE_TYPING_INDICATOR=true
ENABLE_DARK_MODE=true

# Database (if using)
DB_HOST=localhost
DB_DATABASE=ai_chat_studio
DB_USERNAME=username
DB_PASSWORD=password
</code>
                </div>

                <h3>API Endpoint Changes</h3>
                
                <h4>v1.0.0 API Structure</h4>
                <div class="code-block">
                    <code>// v1.0.0 - Basic API structure
// chat.php (root level)
$api_key = $_POST['api_key'] ?? '';
$message = $_POST['message'] ?? '';
$model = $_POST['model'] ?? 'gpt-3.5-turbo';

// Direct API call to OpenAI
$response = call_openai_api($api_key, $message, $model);
echo json_encode($response);
</code>
                </div>

                <h4>v2.0.0 API Structure</h4>
                <div class="code-block">
                    <code>// v2.0.0 - RESTful API structure
// api/chat.php
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: POST, GET, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type, Authorization');

// Handle different request methods and providers
$method = $_SERVER['REQUEST_METHOD'];
$data = json_decode(file_get_contents('php://input'), true);

switch ($method) {
    case 'POST':
        $chatHandler = new ChatHandler();
        $response = $chatHandler->processRequest($data);
        echo json_encode($response);
        break;
        
    case 'GET':
        // Return available models, providers, etc.
        $info = [
            'providers' => ['openai', 'anthropic', 'google'],
            'models' => getAvailableModels(),
            'version' => '2.0.0'
        ];
        echo json_encode($info);
        break;
}
</code>
                </div>
            </div>

            <div class="section" id="backup-procedures">
                <h2>Backup Procedures</h2>
                
                <h3>Complete System Backup</h3>
                
                <div class="danger">
                    <strong>Critical:</strong> Always create a complete backup before starting any migration process.
                </div>

                <h4>Database Backup (if applicable)</h4>
                <div class="code-block">
                    <code># MySQL/MariaDB backup
mysqldump -u username -p database_name > backup_$(date +%Y%m%d_%H%M%S).sql

# PostgreSQL backup
pg_dump -U username -h localhost database_name > backup_$(date +%Y%m%d_%H%M%S).sql

# Backup with compression
mysqldump -u username -p database_name | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz
</code>
                </div>

                <h4>File System Backup</h4>
                <div class="code-block">
                    <code># Create backup directory
mkdir -p /path/to/backups/ai-chat-studio-$(date +%Y%m%d)

# Backup entire application
tar -czf /path/to/backups/ai-chat-studio-$(date +%Y%m%d)/files.tar.gz /path/to/your/application/

# Or use rsync for incremental backup
rsync -avz --progress /path/to/your/application/ /path/to/backups/ai-chat-studio-$(date +%Y%m%d)/

# Backup specific important directories
tar -czf config-backup.tar.gz config/ .env *.json *.php
tar -czf assets-backup.tar.gz assets/ css/ js/ images/
tar -czf data-backup.tar.gz uploads/ user-data/ custom/
</code>
                </div>

                <h4>Configuration Backup</h4>
                <div class="code-block">
                    <code># Create comprehensive configuration backup
#!/bin/bash

BACKUP_DIR="config-backup-$(date +%Y%m%d_%H%M%S)"
mkdir -p $BACKUP_DIR

# Copy configuration files
cp .env $BACKUP_DIR/
cp config.php $BACKUP_DIR/ 2>/dev/null || true
cp config.json $BACKUP_DIR/ 2>/dev/null || true
cp *.yml $BACKUP_DIR/ 2>/dev/null || true
cp *.yaml $BACKUP_DIR/ 2>/dev/null || true

# Copy custom themes and styles
cp -r themes/ $BACKUP_DIR/ 2>/dev/null || true
cp -r custom-css/ $BACKUP_DIR/ 2>/dev/null || true

# Create backup manifest
cat > $BACKUP_DIR/manifest.txt << EOF
Configuration Backup Manifest
Created: $(date)
Hostname: $(hostname)
User: $(whoami)
PHP Version: $(php -v | head -1)
Web Server: $(apache2 -v 2>/dev/null || nginx -v 2>/dev/null || echo "Unknown")

Files included:
$(find $BACKUP_DIR -type f | sed 's|$BACKUP_DIR/||' | sort)
EOF

echo "Configuration backup created in $BACKUP_DIR"
</code>
                </div>

                <h3>Backup Verification</h3>
                
                <div class="code-block">
                    <code># Verify backup integrity
tar -tzf files.tar.gz > /dev/null && echo "File backup OK" || echo "File backup FAILED"
gunzip -t config-backup.tar.gz && echo "Config backup OK" || echo "Config backup FAILED"

# Test database backup
mysql -u username -p database_name < /dev/null  # Test MySQL connection
# Or for PostgreSQL
pg_restore --list backup.sql | head -10  # Verify PostgreSQL backup
</code>
                </div>

                <div class="success">
                    <strong>Backup Best Practices:</strong>
                    <ul>
                        <li>Store backups in multiple locations (local + remote)</li>
                        <li>Test backup restoration regularly</li>
                        <li>Keep multiple backup versions</li>
                        <li>Encrypt sensitive backups</li>
                        <li>Document backup procedures</li>
                    </ul>
                </div>
            </div>

            <div class="section" id="migration-process">
                <h2>Migration Process</h2>
                
                <h3>Step-by-Step Migration</h3>
                
                <div class="migration-step">
                    <h4>Step 1: Preparation</h4>
                    <ol>
                        <li>Complete backup of current system</li>
                        <li>Document current configuration</li>
                        <li>Set up test environment</li>
                        <li>Download v2.0.0 files</li>
                        <li>Schedule maintenance window</li>
                    </ol>
                </div>

                <div class="migration-step">
                    <h4>Step 2: Side-by-Side Installation</h4>
                    <div class="code-block">
                        <code># Create new directory for v2.0.0
mkdir ai-chat-studio-v2
cd ai-chat-studio-v2

# Download and extract v2.0.0
wget https://github.com/your-repo/ai-chat-studio/archive/v2.0.0.tar.gz
tar -xzf v2.0.0.tar.gz
mv ai-chat-studio-2.0.0/* .

# Set permissions
chmod -R 755 .
chown -R www-data:www-data .  # or your web server user
</code>
                    </div>
                </div>

                <div class="migration-step">
                    <h4>Step 3: Configuration Migration</h4>
                    <div class="code-block">
                        <code># Copy old configuration and adapt
cp ../v1.0.0/config.php ./config-old.php

# Create new .env file from old config
cat > .env << EOF
APP_ENV=production
APP_DEBUG=false
APP_URL=https://your-domain.com

# Migrate OpenAI configuration
OPENAI_API_KEY=$(grep -oP "api_key.*'\K[^']+" ../v1.0.0/config.php)
OPENAI_MODEL=$(grep -oP "model.*'\K[^']+" ../v1.0.0/config.php)
OPENAI_MAX_TOKENS=$(grep -oP "max_tokens.*\K[0-9]+" ../v1.0.0/config.php)

# UI settings
DEFAULT_THEME=$(grep -oP "theme.*'\K[^']+" ../v1.0.0/config.php)
DEFAULT_LANGUAGE=$(grep -oP "language.*'\K[^']+" ../v1.0.0/config.php)
EOF

# Secure the .env file
chmod 600 .env
</code>
                    </div>
                </div>

                <div class="migration-step">
                    <h4>Step 4: Data Migration</h4>
                    <div class="code-block">
                        <code># Migrate user data if applicable
if [ -d "user-data" ] && [ -d "../v1.0.0/user-data" ]; then
    cp -r ../v1.0.0/user-data/* ./user-data/
fi

# Migrate custom themes/styles
if [ -d "themes" ] && [ -d "../v1.0.0/themes" ]; then
    cp -r ../v1.0.0/themes/* ./themes/
fi

# Migrate uploaded files
if [ -d "uploads" ] && [ -d "../v1.0.0/uploads" ]; then
    cp -r ../v1.0.0/uploads/* ./uploads/
fi

# Migrate custom JavaScript modifications
if [ -f "../v1.0.0/assets/app.js" ] && [ -f "./assets/js/app.js" ]; then
    # Extract custom modifications from old app.js
    # This will require manual review and adaptation
    cp ../v1.0.0/assets/app.js ./assets/js/app-old.js
fi
</code>
                    </div>
                </div>

                <div class="migration-step">
                    <h4>Step 5: Database Migration (if applicable)</h4>
                    <div class="code-block">
                        <code># Example database migration script
<?php
// migration-script.php
require_once 'vendor/autoload.php';

// Connect to old database
$old_pdo = new PDO('mysql:host=localhost;dbname=ai_chat_v1', $username, $password);

// Connect to new database
$new_pdo = new PDO('mysql:host=localhost;dbname=ai_chat_v2', $username, $password);

// Migrate chat history
$stmt = $old_pdo->query("SELECT * FROM chat_sessions");
$chatSessions = $stmt->fetchAll(PDO::FETCH_ASSOC);

foreach ($chatSessions as $session) {
    $insert_stmt = $new_pdo->prepare("
        INSERT INTO chat_sessions (id, user_id, title, created_at, updated_at) 
        VALUES (?, ?, ?, ?, ?)
    ");
    $insert_stmt->execute([
        $session['id'],
        $session['user_id'],
        $session['title'],
        $session['created_at'],
        $session['updated_at']
    ]);
}

// Migrate user preferences
$stmt = $old_pdo->query("SELECT * FROM user_preferences");
$preferences = $stmt->fetchAll(PDO::FETCH_ASSOC);

foreach ($preferences as $pref) {
    $insert_stmt = $new_pdo->prepare("
        INSERT INTO user_preferences (user_id, theme, language, settings) 
        VALUES (?, ?, ?, ?)
    ");
    $insert_stmt->execute([
        $pref['user_id'],
        $pref['theme'],
        $pref['language'],
        json_encode($pref['settings'])
    ]);
}

echo "Database migration completed\n";
?>
</code>
                    </div>
                </div>

                <div class="migration-step">
                    <h4>Step 6: Testing</h4>
                    <div class="code-block">
                        <code># Run migration test script
php migration-test.php

# Test API endpoints
curl -X GET http://localhost:8001/api/chat.php
curl -X POST http://localhost:8001/api/chat.php \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, test message"}'

# Test in browser
# Visit http://localhost:8001 and verify functionality
</code>
                    </div>
                </div>

                <div class="migration-step">
                    <h4>Step 7: Production Deployment</h4>
                    <div class="code-block">
                        <code># During maintenance window

# 1. Stop web server (optional - can use separate port)
sudo systemctl stop apache2  # or nginx

# 2. Backup current version
mv ai-chat-studio ai-chat-studio-backup

# 3. Deploy new version
mv ai-chat-studio-v2 ai-chat-studio

# 4. Set permissions
chown -R www-data:www-data ai-chat-studio
chmod -R 755 ai-chat-studio

# 5. Update web server configuration if needed
# Update DocumentRoot or create new virtual host

# 6. Start web server
sudo systemctl start apache2

# 7. Verify deployment
curl -I https://your-domain.com
</code>
                    </div>
                </div>
            </div>

            <div class="section" id="post-migration">
                <h2>Post-Migration Verification</h2>
                
                <h3>Functionality Testing</h3>
                
                <h4>API Testing</h4>
                <div class="code-block">
                    <code># Test basic API functionality
#!/bin/bash

BASE_URL="https://your-domain.com"

echo "Testing API endpoints..."

# Test GET endpoint (health check)
echo "1. Testing GET endpoint..."
curl -s -w "\nHTTP Status: %{http_code}\n" $BASE_URL/api/chat.php

# Test POST endpoint
echo "2. Testing POST endpoint..."
curl -s -X POST $BASE_URL/api/chat.php \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, this is a test message", "provider": "openai"}' \
  -w "\nHTTP Status: %{http_code}\n"

# Test error handling
echo "3. Testing error handling..."
curl -s -X POST $BASE_URL/api/chat.php \
  -H "Content-Type: application/json" \
  -d '{"message": ""}' \
  -w "\nHTTP Status: %{http_code}\n"

echo "API testing completed"
</code>
                </div>

                <h4>UI Testing Checklist</h4>
                <div class="success">
                    <strong>UI/UX Verification:</strong>
                    <ul>
                        <li><i class="fas fa-check-circle"></i> Main page loads correctly</li>
                        <li><i class="fas fa-check-circle"></i> Chat interface is functional</li>
                        <li><i class="fas fa-check-circle"></i> Messages can be sent and received</li>
                        <li><i class="fas fa-check-circle"></i> Settings page is accessible</li>
                        <li><i class="fas fa-check-circle"></i> Theme switching works</li>
                        <li><i class="fas fa-check-circle"></i> Mobile responsiveness</li>
                        <li><i class="fas fa-check-circle"></i> Dark mode toggle (if applicable)</li>
                        <li><i class="fas fa-check-circle"></i> Error messages display properly</li>
                        <li><i class="fas fa-check-circle"></i> Loading states are visible</li>
                        <li><i class="fas fa-check-circle"></i> Accessibility features work</li>
                    </ul>
                </div>

                <h3>Performance Verification</h3>
                
                <div class="code-block">
                    <code># Performance testing script
<?php
// performance-test.php

function measureResponseTime($url, $postData = null) {
    $start = microtime(true);
    
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_TIMEOUT, 30);
    
    if ($postData) {
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    }
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    $end = microtime(true);
    $duration = ($end - $start) * 1000; // Convert to milliseconds
    
    return [
        'duration' => round($duration, 2),
        'http_code' => $httpCode,
        'success' => $httpCode === 200
    ];
}

// Test multiple requests
$results = [];
for ($i = 0; $i < 5; $i++) {
    $results[] = measureResponseTime('https://your-domain.com/api/chat.php', [
        'message' => 'Test message ' . ($i + 1),
        'provider' => 'openai'
    ]);
}

// Calculate averages
$avgDuration = array_sum(array_column($results, 'duration')) / count($results);
$successRate = (count(array_filter($results, fn($r) => $r['success'])) / count($results)) * 100;

echo "Performance Test Results:\n";
echo "Average response time: {$avgDuration}ms\n";
echo "Success rate: {$successRate}%\n";
echo "All tests: " . (($successRate === 100) ? "PASSED" : "FAILED") . "\n";
?>
</code>
                </div>

                <h3>Security Verification</h3>
                
                <div class="code-block">
                    <code># Security testing checklist
# 1. Check HTTPS is working
curl -I https://your-domain.com

# 2. Test API key exposure
curl -X POST https://your-domain.com/api/chat.php \
  -H "Content-Type: application/json" \
  -d '{"message": "test"}' \
  | grep -i "sk-" && echo "ERROR: API key exposed!" || echo "API key protected: OK"

# 3. Check CSP headers
curl -I https://your-domain.com | grep -i "content-security-policy"

# 4. Test rate limiting
for i in {1..15}; do
  curl -X POST https://your-domain.com/api/chat.php \
    -H "Content-Type: application/json" \
    -d '{"message": "test"}' \
    -w "%{http_code}\n" -s -o /dev/null
  sleep 0.1
done

# 5. Check for sensitive file exposure
curl -s https://your-domain.com/.env && echo "ERROR: .env exposed!" || echo ".env protected: OK"
curl -s https://your-domain.com/config.php && echo "ERROR: config exposed!" || echo "config.php protected: OK"
</code>
                </div>
            </div>

            <div class="section" id="rollback-procedures">
                <h2>Rollback Procedures</h2>
                
                <h3>Emergency Rollback</h3>
                
                <div class="danger">
                    <strong>Emergency Procedure:</strong> If critical issues are discovered after migration, follow these steps immediately to restore service.
                </div>

                <h4>Quick Rollback Steps</h4>
                <div class="code-block">
                    <code># EMERGENCY ROLLBACK (execute immediately)

# 1. Stop web server to prevent further issues
sudo systemctl stop apache2  # or nginx

# 2. Restore backup immediately
rm -rf ai-chat-studio  # Remove problematic version
mv ai-chat-studio-backup ai-chat-studio  # Restore backup

# 3. Restore permissions
chown -R www-data:www-data ai-chat-studio
chmod -R 755 ai-chat-studio

# 4. Start web server
sudo systemctl start apache2

# 5. Verify service is restored
curl -I https://your-domain.com

echo "Rollback completed. Service should be restored."
</code>
                </div>

                <h3>Partial Rollback</h3>
                
                <h4>Configuration Rollback</h4>
                <div class="code-block">
                    <code># Rollback only configuration changes

# 1. Restore previous configuration
cp config-backup-YYYYMMDD/.env ./
cp config-backup-YYYYMMDD/config.php ./includes/

# 2. Test configuration
php -l includes/config.php
php -l .env

# 3. Restart services if needed
sudo systemctl restart apache2
</code>
                </div>

                <h4>Database Rollback</h4>
                <div class="code-block">
                    <code># Rollback database changes

# 1. Restore database from backup
mysql -u username -p database_name < backup_YYYYMMDD_HHMMSS.sql

# 2. Verify restoration
mysql -u username -p -e "SELECT COUNT(*) FROM chat_sessions;"

# 3. Test application functionality
# Visit your application and verify data integrity
</code>
                </div>

                <h3>Rollback Testing</h3>
                
                <div class="code-block">
                    <code># Post-rollback verification

# 1. Test basic functionality
curl -s https://your-domain.com | grep -q "AI Chat Studio" && echo "Main page: OK" || echo "Main page: FAILED"

# 2. Test API endpoints
curl -s -X POST https://your-domain.com/api/chat.php \
  -H "Content-Type: application/json" \
  -d '{"message": "rollback test"}' \
  | grep -q "success" && echo "API: OK" || echo "API: FAILED"

# 3. Test database connectivity
php -r "
try {
    \$pdo = new PDO('mysql:host=localhost;dbname=ai_chat_studio', 'username', 'password');
    echo 'Database: OK\n';
} catch (Exception \$e) {
    echo 'Database: FAILED - ' . \$e->getMessage() . '\n';
}"

# 4. Check error logs
tail -50 /var/log/apache2/error.log | grep -i error | tail -5
</code>
                </div>
            </div>

            <div class="section" id="troubleshooting">
                <h2>Troubleshooting</h2>
                
                <h3>Common Migration Issues</h3>
                
                <h4>Issue: "500 Internal Server Error"</h4>
                <div class="warning">
                    <strong>Solutions:</strong>
                    <ul>
                        <li>Check PHP error logs: <code>tail -f /var/log/php_errors.log</code></li>
                        <li>Verify PHP version compatibility: <code>php -v</code></li>
                        <li>Check file permissions: <code>chmod -R 755 .</code></li>
                        <li>Validate configuration files: <code>php -l config.php</code></li>
                        <li>Ensure required PHP extensions are installed</li>
                    </ul>
                </div>

                <h4>Issue: "API Key Not Working"</h4>
                <div class="warning">
                    <strong>Solutions:</strong>
                    <ul>
                        <li>Check environment variable format in .env file</li>
                        <li>Verify API key is valid and has sufficient credits</li>
                        <li>Ensure proper environment variable loading</li>
                        <li>Check for extra spaces or characters in API key</li>
                        <li>Test API key directly with provider's API</li>
                    </ul>
                </div>

                <h4>Issue: "Database Connection Failed"</h4>
                <div class="warning">
                    <strong>Solutions:</strong>
                    <ul>
                        <li>Verify database credentials in .env file</li>
                        <li>Check database server is running: <code>systemctl status mysql</code></li>
                        <li>Test database connectivity: <code>mysql -u username -p</code></li>
                        <li>Ensure database exists and user has proper permissions</li>
                        <li>Check for network/firewall issues</li>
                    </ul>
                </div>

                <h4>Issue: "Frontend Not Loading"</h4>
                <div class="warning">
                    <strong>Solutions:</strong>
                    <ul>
                        <li>Check web server configuration and document root</li>
                        <li>Verify .htaccess file exists and has correct permissions</li>
                        <li>Check browser console for JavaScript errors</li>
                        <li>Ensure CSS/JS files are accessible</li>
                        <li>Verify MIME types are correctly configured</li>
                    </ul>
                </div>

                <h3>Debugging Tools</h3>
                
                <h4>Migration Diagnostic Script</h4>
                <div class="code-block">
                    <code><?php
// migration-diagnostic.php
// Run this script to diagnose migration issues

echo "AI Chat Studio Migration Diagnostic\n";
echo "===================================\n\n";

// Check PHP version
echo "1. PHP Version:\n";
echo "   Current: " . PHP_VERSION . "\n";
echo "   Required: 7.4+\n";
echo "   Status: " . (version_compare(PHP_VERSION, '7.4.0', '>=') ? "OK" : "FAIL") . "\n\n";

// Check PHP extensions
echo "2. PHP Extensions:\n";
$required_extensions = ['curl', 'json', 'mbstring', 'openssl'];
foreach ($required_extensions as $ext) {
    $loaded = extension_loaded($ext);
    echo "   $ext: " . ($loaded ? "OK" : "MISSING") . "\n";
}
echo "\n";

// Check file permissions
echo "3. File Permissions:\n";
$check_files = ['.env', 'index.php', 'api/chat.php'];
foreach ($check_files as $file) {
    if (file_exists($file)) {
        $perms = substr(sprintf('%o', fileperms($file)), -4);
        echo "   $file: $perms\n";
    } else {
        echo "   $file: NOT FOUND\n";
    }
}
echo "\n";

// Check configuration
echo "4. Configuration Check:\n";
if (file_exists('.env')) {
    $env_content = file_get_contents('.env');
    $required_vars = ['OPENAI_API_KEY', 'APP_URL'];
    foreach ($required_vars as $var) {
        $found = strpos($env_content, $var . '=') !== false;
        echo "   $var: " . ($found ? "SET" : "MISSING") . "\n";
    }
} else {
    echo "   .env file: NOT FOUND\n";
}
echo "\n";

// Test database connection if configured
echo "5. Database Connection:\n";
try {
    $host = getenv('DB_HOST') ?: 'localhost';
    $dbname = getenv('DB_DATABASE') ?: 'ai_chat_studio';
    $username = getenv('DB_USERNAME') ?: 'root';
    $password = getenv('DB_PASSWORD') ?: '';
    
    if ($host && $dbname) {
        $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
        echo "   Database: CONNECTED\n";
    } else {
        echo "   Database: NOT CONFIGURED\n";
    }
} catch (Exception $e) {
    echo "   Database: FAILED - " . $e->getMessage() . "\n";
}
echo "\n";

// Check directory structure
echo "6. Directory Structure:\n";
$required_dirs = ['api', 'assets', 'assets/css', 'assets/js', 'pages'];
foreach ($required_dirs as $dir) {
    $exists = is_dir($dir);
    echo "   $dir: " . ($exists ? "EXISTS" : "MISSING") . "\n";
}
echo "\n";

echo "Diagnostic completed.\n";
?>
</code>
                </div>

                <h3>Getting Help</h3>
                
                <div class="info">
                    <strong>Support Resources:</strong>
                    <ul>
                        <li><strong>Documentation:</strong> Check the latest documentation for updated procedures</li>
                        <li><strong>GitHub Issues:</strong> Report bugs or ask questions on the project repository</li>
                        <li><strong>Community Forum:</strong> Join discussions with other users</li>
                        <li><strong>Professional Support:</strong> Consider hiring a developer for complex migrations</li>
                    </ul>
                </div>

                <div class="success">
                    <strong>Migration Success!</strong> If you've completed all steps successfully, your AI Chat Studio should now be running on v2.0.0 with enhanced features and improved performance. Remember to monitor the system closely for the first few days to ensure everything is working correctly.
                </div>
            </div>
        </div>
    </div>
</body>
</html>